#  라우팅 기능은 OSI 7계층 중 어디서 작동하는지 설명해보세요.

- 네트워크 계층(Network Layer)


그럼 라우터를 통해서 데이터가 전송이 된다고 하는데 어떻게 전송이 되는 것일까?

 - 순서적으로 1계층을 통해서 데이터가 라우터로 전송이 되면
 - 라우터는 전자 기파 내용을 디코딩 후 해당 데이터를 열어서 프레임을 확인한다.
 ![3주차3.png](../img/3주차3.png)
 -  이것이 나에게 온 mac 주소인지 확인합니다. 
    - 아니라면 아래 3계층을 열어서 ip 주소를 확인합니다. 
    - 그러면 라우터는 라우팅 테이블을 조회해서 해당 ip를 가지고 있는 mac 주소를 ARP(Address Resolution Protocol) 통해서 알아내고 프레임을 다시 재구성하여 다른 라우터로 전송합니다. 
    ![라우팅테이블.png](../img/라우팅테이블.png)
    ![arp.png](../img/arp.png)
    - 맞다면 해당 내용은 네트워크 계층(Network Layer)에서 데이터를 열어서 해당 목적지에 데이터를 전달합니다.

  ![데이터흐름.png](../img/데이터흐름.png)

  ---
  참고 사항 
  ---
  - ARP 란
 > ARP (Address Resolution Protocol)는 네트워크 내에서 IP 주소를 물리적인 MAC 주소로 변환하는 데 사용되는 프로토콜입니다. 이는 데이터 링크 계층과 네트워크 계층 사이에서 작동하며, 동일한 네트워크 세그먼트 내의 장치 간의 통신을 가능하게 합니다. ARP는 네트워크 장치가 상호 통신하기 위해 필수적인 역할을 수행합니다. 다음은 ARP의 작동 원리와 과정을 설명하는 단계입니다:

ARP의 주요 개념
IP 주소 (Internet Protocol Address):

네트워크 계층에서 사용되는 주소로, 네트워크 내에서 장치를 식별합니다.
예: 192.168.1.10
MAC 주소 (Media Access Control Address):

데이터 링크 계층에서 사용되는 고유한 하드웨어 주소로, 네트워크 인터페이스 카드(NIC)에 할당됩니다.
예: 00:1A:2B:3C:4D:5E
ARP 작동 과정
ARP 요청 (ARP Request):

네트워크 상의 장치 A가 IP 주소 192.168.1.20을 가진 장치 B의 MAC 주소를 알아야 할 때, 장치 A는 브로드캐스트 ARP 요청 패킷을 네트워크에 보냅니다.
ARP 요청 패킷에는 장치 A의 IP 주소와 MAC 주소, 그리고 장치 B의 IP 주소가 포함됩니다.

코드 복사
장치 A: "192.168.1.20의 MAC 주소가 뭐야?"
ARP 응답 (ARP Reply):

네트워크 내 모든 장치는 ARP 요청을 수신하고, 해당 IP 주소가 자신의 것인지 확인합니다.
장치 B가 자신의 IP 주소와 일치함을 확인하면, 장치 B는 자신의 MAC 주소를 포함한 ARP 응답 패킷을 장치 A에게 유니캐스트로 보냅니다.

코드 복사
장치 B: "192.168.1.20은 나야, 내 MAC 주소는 00:1A:2B:3C:4D:5E야."

ARP 캐시 (ARP Cache):

장치 A는 응답을 수신한 후, 해당 IP 주소와 MAC 주소의 매핑을 ARP 캐시에 저장합니다.
이 캐시는 일정 시간 동안 유지되며, 이후 같은 IP 주소로 패킷을 전송할 때 재사용됩니다.

**ARP 캐시와 라우팅 캐시는 다른 개념임**

---
라우터 끼리 이동할때 그 사이를 거치는 방법을 홉이라고 합니다.

서버 A  ->  라우터 1  ->  라우터 2  ->  라우터 3  ->  서버 B
![hop.png](../img/hop.png)

이 경우, 패킷이 서버 A에서 서버 B로 이동하기 위해 3개의 라우터를 거치므로, 총 4개의 홉이 있습니다(서버 A와 서버 B 포함).

홉 수를 줄이는 것은 네트워크 성능 최적화와 문제 해결에 필요합니다.

이러한 홉 라우팅 방식은 주로 다이내믹 라우팅 프로토콜을 사용하여 이루어지며, 홉바이홉 라우팅과 넥스트 홉 라우팅 개념이 결합되어 사용됩니다. OSPF와 BGP 같은 프로토콜이 대표적이며, 네트워크의 규모와 요구 사항에 따라 적절한 라우팅 방법을 선택하게 됩니다.

>  다이내믹 라우팅 (Dynamic Routing)

> 다이내믹 라우팅은 라우터가 자동으로 라우팅 테이블을 업데이트하고 최적 경로를 선택하는 방법입니다. 이를 위해 라우팅 프로토콜이 사용됩니다.

>주요 라우팅 프로토콜
RIP (Routing Information Protocol):
거리 벡터 라우팅 프로토콜로, 홉 수를 기준으로 최적 경로를 결정합니다.
최대 홉 수가 15로 제한되며, 작은 네트워크에 적합합니다.

>OSPF (Open Shortest Path First):
링크 상태 라우팅 프로토콜로, 라우터들이 전체 네트워크의 맵을 공유하여 최단 경로를 계산합니다.
대규모 네트워크에 적합하며, 빠른 수렴 속도를 제공합니다.

>BGP (Border Gateway Protocol):
경로 벡터 라우팅 프로토콜로, 자율 시스템(AS) 간의 경로 정보를 교환합니다.
인터넷의 기본 라우팅 프로토콜로, 대규모 네트워크와 ISP 간의 라우팅에 사용됩니다.

---
라우트 캐싱
>한 번 스위칭 작업을 수행했다면 수행 정보를 캐시에 저장하고 뒤에 들어오는 패킷은 라우팅 테이블을 확인하기전에 캐시를 먼저 확인한다. 
이 방식이 효과적인 이유는 패킷 네트워크에서 데이터를 보내기 위해 출발지 IP, 도착지 IP, 포트 번호가 모두 동일한 곳으로 여러 패킷이 연속적으로 보내지기 때문이다. 즉, 같은 곳으로 여러 데이터가 들어갈때마다 최적 경로를 찾는 작업을 다시 수행하는것은 비효율적이기이 캐시를 통해 이를 해결한다. 